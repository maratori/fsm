<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="890px" preserveAspectRatio="none" style="width:1216px;height:890px;" version="1.1" viewBox="0 0 1216 890" width="1216px" zoomAndPan="magnify"><defs><filter height="300%" id="f1msqdqnknwxjl" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="221" x="490" y="16.708">About FSM with memory</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="603.5" y="37.6611"/><path d="M1073,190.9063 L1073,261.4375 L1207,261.4375 L1207,200.9063 L1197,190.9063 L1073,190.9063 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1197,190.9063 L1197,200.9063 L1207,200.9063 L1197,190.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="1083" y="207.9731">It's forbidden</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="1083" y="223.106">to have different</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="1083" y="238.2388">transition types</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="1083" y="253.3716">from single state</text><g id="StateWithCallback"><rect fill="#ADD8E6" filter="url(#f1msqdqnknwxjl)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="197" x="88.5" y="489.4063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="88.5" x2="285.5" y1="515.7031" y2="515.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="125.5" y="507.4014">StateWithCallback</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="177" x="93.5" y="531.8418">functionToExecuteOnEnter()</text></g><path d="M321,463.9063 L321,510.4063 L285.5039,514.4063 L321,518.4063 L321,564.7031 A0,0 0 0 0 321,564.7031 L657,564.7031 A0,0 0 0 0 657,564.7031 L657,473.9063 L647,463.9063 L321,463.9063 A0,0 0 0 0 321,463.9063 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M647,463.9063 L647,473.9063 L657,473.9063 L647,463.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="327" y="480.9731">Callback function may be associated with a state.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="331" y="496.106"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="327" y="511.2388">FSM will call this function on enter to the state.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="331" y="526.3716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="327" y="541.5044">Function will</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="407" y="541.5044">not</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="435" y="541.5044">be called</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="327" y="556.6372">if FSM is restored from DB already in this state.</text><g id="IntermediateStateWithCallback"><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="230" x="72" y="624.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="72" x2="302" y1="651.2031" y2="651.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="210" x="82" y="642.9014">IntermediateStateWithCallback</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="114" x="77" y="667.3418">anotherFunction()</text></g><path d="M337,629.9063 L337,645.9063 L302.2363,649.9063 L337,653.9063 L337,670.1719 A0,0 0 0 0 337,670.1719 L591,670.1719 A0,0 0 0 0 591,670.1719 L591,639.9063 L581,629.9063 L337,629.9063 A0,0 0 0 0 337,629.9063 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M581,629.9063 L581,639.9063 L591,639.9063 L581,629.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="343" y="646.9731">Callback function may be associated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="343" y="662.106">with intermediate state as well.</text><rect fill="#FFFFFF" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #D3D3D3; stroke-width: 1.5;" width="110" x="132" y="787.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="137" y="812.7529">About Memory</text><path d="M277.5,734.9063 L277.5,803.9063 L242.0781,807.9063 L277.5,811.9063 L277.5,881.1016 A0,0 0 0 0 277.5,881.1016 L696.5,881.1016 A0,0 0 0 0 696.5,881.1016 L696.5,744.9063 L686.5,734.9063 L277.5,734.9063 A0,0 0 0 0 277.5,734.9063 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M686.5,734.9063 L686.5,744.9063 L696.5,744.9063 L686.5,734.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="283.5" y="751.9731">FSM has fixed amount of memory slots.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="287.5" y="767.106"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="283.5" y="782.2388">Each slot is a variable with name and type.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="287.5" y="797.3716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="398" x="283.5" y="812.5044">FSM uses those variables to evaluate conditional transactions.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="287.5" y="827.6372"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="376" x="283.5" y="842.77">Store FSM to DB means saving current state and memory.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="287.5" y="857.9028"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="283.5" y="873.0356">Callback function may not read memory, only write it.</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="340.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="360" x="7" y="56.4063"/><rect fill="#FFFFFF" height="308" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="354" x="10" y="85.7031"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="367" y1="82.7031" y2="82.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="255" x="59.5" y="74.4014">Transition on external event received</text><rect fill="#ADD8E6" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="103" y="131.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="9" x="123.5" y="156.5498">A</text><path d="M171,93.7031 L171,147.7031 L153.2578,151.7031 L171,155.7031 L171,209.6328 A0,0 0 0 0 171,209.6328 L329,209.6328 A0,0 0 0 0 329,209.6328 L329,103.7031 L319,93.7031 L171,93.7031 A0,0 0 0 0 171,93.7031 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M319,93.7031 L319,103.7031 L329,103.7031 L319,93.7031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="177" y="110.77">State A is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="71" x="243" y="110.77">permanent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="177" y="125.9028">because FSM will wait</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="177" y="141.0356">for external event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="177" y="156.1685">to change state.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="181" y="171.3013"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="177" y="186.4341">FSM may be stored</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="11" x="177" y="201.5669">in</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="19" x="192" y="201.5669">DB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="215" y="201.5669">in state A.</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="19" y="338.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="10" x="39" y="363.5498">B</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="188" y="338.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="10" x="208" y="363.5498">C</text><!--MD5=[5e2eec62a50b26b6b0db6c12e4ee289c]
link A to B--><path d="M106.9371,172.0874 C86.6642,193.2856 57.3231,228.5214 45,265.7031 C37.7101,287.6984 38.2791,314.2585 40.1867,333.3537 " fill="none" id="A-to-B" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="40.7549,338.5315,43.7493,329.1489,40.2095,333.5614,35.797,330.0216,40.7549,338.5315" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="46" y="278.77">ExternalEventName</text><!--MD5=[e1650921a81fac0037ec207a42ac4e7e]
link A to C--><path d="M139.9623,171.7748 C156.1235,199.1484 183.7491,246.9293 191,265.7031 C199.5784,287.9141 205.4525,314.4481 208.9586,333.4786 " fill="none" id="A-to-C" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="209.8849,338.6374,212.2312,329.0721,209.0012,333.7161,204.3572,330.4861,209.8849,338.6374" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="198" y="278.77">AnotherExternalEvent</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="355.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="322.5" x="402.5" y="48.9063"/><rect fill="#FFFFFF" height="323" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="316.5" x="405.5" y="78.2031"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="402.5" x2="725" y1="75.2031" y2="75.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="156" x="485.75" y="66.9014">Transition by condition</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="454.5" y="169.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="11" x="474" y="194.5498">D</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="414.5" y="346.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="9" x="435" y="371.0498">E</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="495.5" y="346.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="8" x="516.5" y="371.0498">F</text><path d="M523,86.2031 L523,185.7031 L504.6563,189.7031 L523,193.7031 L523,292.9297 A0,0 0 0 0 523,292.9297 L716,292.9297 A0,0 0 0 0 716,292.9297 L716,96.2031 L706,86.2031 L523,86.2031 A0,0 0 0 0 523,86.2031 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M706,86.2031 L706,96.2031 L716,96.2031 L706,86.2031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="529" y="103.27">State D is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="82" x="596" y="103.27">intermediate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="529" y="118.4028">because FSM will change</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="529" y="133.5356">state according conditions.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="533" y="148.6685"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="529" y="163.8013">Exactly one condition</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="529" y="178.9341">must be</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="586" y="178.9341">true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="616" y="178.9341">.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="533" y="194.0669"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="529" y="209.1997">So FSM can't stay</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="529" y="224.3325">(and can't be stored)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="529" y="239.4653">in state D.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="533" y="254.5981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="529" y="269.731">Conditions use data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="529" y="284.8638">from FSM</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="54" x="594" y="284.8638">memory</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="648" y="284.8638">.</text><!--MD5=[9ee2c6850258a89d754920901add40c0]
link D to E--><path d="M471.0022,209.8878 C461.4833,233.6347 446.5908,274.4865 440.5,311.2031 C438.9044,320.8218 438.4224,331.516 438.4196,340.8981 " fill="none" id="D-to-E" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="438.4633,345.9602,442.3852,336.9259,438.42,340.9604,434.3855,336.9952,438.4633,345.9602" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="441.5" y="324.27">[a &gt;= b]</text><!--MD5=[b5b953319cf24ea105ede322ce2bfc63]
link D to F--><path d="M484.2032,209.9499 C491.7413,242.4002 506.5097,305.9766 514.6936,341.2072 " fill="none" id="D-to-F" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="515.8516,346.1924,517.7113,336.5207,514.7202,341.3221,509.9188,338.331,515.8516,346.1924" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="512.5" y="324.27">[a &lt; b]</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="315.5938" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="276.5" x="760.5" y="68.4063"/><rect fill="#FFFFFF" height="267" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="270.5" x="763.5" y="114"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="760.5" x2="1037" y1="111" y2="111"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="851.75" y="86.4014">Unconditional</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="866.75" y="102.6982">transition</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="772.5" y="167.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="11" x="792" y="192.3467">G</text><rect fill="#FEFECE" filter="url(#f1msqdqnknwxjl)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="772.5" y="326"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="10" x="792.5" y="350.8467">H</text><path d="M841,122 L841,183.5 L822.6523,187.5 L841,191.5 L841,253.0625 A0,0 0 0 0 841,253.0625 L1028,253.0625 A0,0 0 0 0 1028,253.0625 L1028,132 L1018,122 L841,122 A0,0 0 0 0 841,122 " fill="#FBFB77" filter="url(#f1msqdqnknwxjl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1018,122 L1018,132 L1028,132 L1018,122 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="847" y="139.0669">State G is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="82" x="914" y="139.0669">intermediate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="847" y="154.1997">because FSM will change</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="847" y="169.3325">state immediately without</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="847" y="184.4653">any condition.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="851" y="199.5981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="847" y="214.731">So FSM can't stay</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="847" y="229.8638">(and can't be stored)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="847" y="244.9966">in state G.</text><!--MD5=[ce77ec9f82fbfc6e257d1b6e5dac829e]
link G to H--><path d="M797.5,207.5741 C797.5,236.3162 797.5,289.1852 797.5,320.6095 " fill="none" id="G-to-H" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="797.5,325.8391,801.5,316.8391,797.5,320.8391,793.5,316.8391,797.5,325.8391" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[7d83cb38fd1d7b900e2eb1a72a219871]
link TTT1 to TTT2--><!--MD5=[482e776b10b1cdd6b59adebc11bcfcdb]
link TTT2 to TTT3--><!--MD5=[fc9a636bb4bf227d7c51e4521cd4e502]
link TTT1 to StateWithCallback--><!--MD5=[eee1717aa3916df182101f17a0d9bbe5]
link StateWithCallback to IntermediateStateWithCallback--><!--MD5=[5146e634615756392f8796a0471fe448]
link IntermediateStateWithCallback to Memory--><!--MD5=[7e30f159590703c166e2c4b827135b0c]
@startuml
hide empty description

title About FSM with memory\n

skinparam StateBackgroundColor<<Permanent>> LightBlue

note " It's forbidden \n to have different \n transition types \n from single state" as Note

state "Transition on external event received" as TTT1 {
	state A <<Permanent>>
	note right of A
		State A is __permanent__
		because FSM will wait
		for external event
		to change state.

		FSM may be stored
		in __DB__ in state A.
	end note
	A -[bold]- - -> B : **ExternalEventName**
	A -[bold]- - -> C : **AnotherExternalEvent**
}

state "Transition by condition" as TTT2 {
	D - -> E : [a >= b]
	D - -> F : [a < b]
	note right of D
		State D is __intermediate__
		because FSM will change
		state according conditions.

		Exactly one condition
		must be **true**.

		So FSM can't stay
		(and can't be stored)
		in state D.

		Conditions use data
		from FSM __memory__.
	end note
}

state "Unconditional\ntransition" as TTT3 {
	G -[dashed]- -> H
	note right of G
		State G is __intermediate__
		because FSM will change
		state immediately without
		any condition.

		So FSM can't stay
		(and can't be stored)
		in state G.
	end note
}

state StateWithCallback <<Permanent>> : functionToExecuteOnEnter()
note right of StateWithCallback
	Callback function may be associated with a state.

	FSM will call this function on enter to the state.

	Function will **not** be called
	if FSM is restored from DB already in this state.
end note

state IntermediateStateWithCallback : anotherFunction()
note right of IntermediateStateWithCallback
	Callback function may be associated
	with intermediate state as well.
end note

skinparam StateBackgroundColor<<M>> White
skinparam StateBorderColor<<M>> LightGrey
state "About Memory" as Memory<<M>>
note right of Memory
	FSM has fixed amount of memory slots.

	Each slot is a variable with name and type.

	FSM uses those variables to evaluate conditional transactions.

	Store FSM to DB means saving current state and memory.

	Callback function may not read memory, only write it.
end note

TTT1 -right[hidden]-> TTT2
TTT2 -right[hidden]-> TTT3
TTT1 -down[hidden]-> StateWithCallback
StateWithCallback -down[hidden]-> IntermediateStateWithCallback
IntermediateStateWithCallback -down[hidden]-> Memory

@enduml

PlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>