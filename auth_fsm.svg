<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1357px" preserveAspectRatio="none" style="width:1197px;height:1357px;" version="1.1" viewBox="0 0 1197 1357" width="1197px" zoomAndPan="magnify"><defs><filter height="300%" id="fibpwux01f2ae" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="161" x="511.75" y="16.708">Authorization FSM</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="595.25" y="37.6611"/><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="173.5" y="53.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="181.5" y="78.7529">Initial</text><g id="New"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="393" y="48.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="393" x2="518" y1="75.2031" y2="75.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="440.5" y="66.9014">New</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="398" y="91.3418">createPayment()</text></g><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="393" y="164.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="398" y="189.7529">PaymentCreated</text><g id="PaymentSucceeded"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="159" x="299" y="435.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="299" x2="458" y1="462.2031" y2="462.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="309" y="453.9014">PaymentSucceeded</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="304" y="478.3418">createAuth()</text></g><g id="PaymentPending"><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="11" y="159.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="11" x2="148" y1="186.2031" y2="186.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="21" y="177.9014">PaymentPending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="16" y="202.3418">scheduleJob()</text></g><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="749.5" y="164.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="754.5" y="189.7529">PaymentFailed</text><g id="PaymentWaitForRetry"><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="721" y="301.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="721" x2="888" y1="328.2031" y2="328.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="731" y="319.9014">PaymentWaitForRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="726" y="344.3418">scheduleJob()</text></g><g id="CheckPaymentStatus"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="207" x="101" y="301.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="101" x2="308" y1="328.2031" y2="328.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="130.5" y="319.9014">CheckPaymentStatus</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="187" x="106" y="344.3418">getPaymentStatusFromZooz()</text></g><g id="PaymentRetry"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="634" y="428.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="634" x2="785" y1="455.2031" y2="455.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="661.5" y="446.9014">PaymentRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="639" y="471.3418">createPayment()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="131" x="639" y="485.3105">paymentAttempts++</text></g><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="330" y="558.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="335" y="583.7529">AuthCreated</text><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="265" y="834.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="270" y="859.7529">AuthSucceeded</text><g id="AuthPending"><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="7" y="553.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="116" y1="580.2031" y2="580.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="17" y="571.9014">AuthPending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="12" y="596.3418">scheduleJob()</text></g><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="618.5" y="558.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="623.5" y="583.7529">AuthFailed</text><g id="AuthWaitForRetry"><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="624" y="695.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="624" x2="763" y1="722.2031" y2="722.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="634" y="713.9014">AuthWaitForRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="629" y="738.3418">scheduleJob()</text></g><g id="CheckAuthStatus"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="182" x="35.5" y="695.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="35.5" x2="217.5" y1="722.2031" y2="722.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="66.5" y="713.9014">CheckAuthStatus</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="40.5" y="738.3418">getAuthStatusFromZooz()</text></g><g id="AuthRetry"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="565.5" y="822.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="565.5" x2="691.5" y1="849.2031" y2="849.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="594.5" y="840.9014">AuthRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="570.5" y="865.3418">createAuth()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="106" x="570.5" y="879.3105">authAttempts++</text></g><g id="SendingSuccessToGPM"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="186" x="232.5" y="947.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="232.5" x2="418.5" y1="974.2031" y2="974.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="166" x="242.5" y="965.9014">SendingSuccessToGPM</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="135" x="237.5" y="990.3418">sendSuccessToGPM()</text></g><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="281" y="1074.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="286" y="1099.7529">Succeeded</text><g id="SendingErrorToGPM"><rect fill="#FEFECE" filter="url(#fibpwux01f2ae)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="863.5" y="695.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="863.5" x2="1023.5" y1="722.2031" y2="722.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="873.5" y="713.9014">SendingErrorToGPM</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="114" x="868.5" y="738.3418">sendErrorToGPM()</text></g><rect fill="#ADD8E6" filter="url(#fibpwux01f2ae)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="918.5" y="834.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="923.5" y="859.7529">Failed</text><!--MD5=[2580f5798eb5af3b4cc67017305f336d]
link Initial to New--><path d="M223.6102,73.9063 C261.2963,73.9063 333.8111,73.9063 387.7621,73.9063 " fill="none" id="Initial-to-New" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="392.9234,73.9063,383.9234,69.9063,387.9234,73.9063,383.9234,77.9063,392.9234,73.9063" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="241.75" y="66.9731">RequestFromGPM</text><!--MD5=[ac09641cf070fd0512798f45784a3aec]
link New to PaymentCreated--><path d="M455.5,99.0938 C455.5,117.0639 455.5,141.1495 455.5,159.2292 " fill="none" id="New-to-PaymentCreated" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="455.5,164.6339,459.5,155.6339,455.5,159.6339,451.5,155.6339,455.5,164.6339" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[5535ea68fd1827fc2aae1cbc899ecbf4]
reverse link PaymentPending to PaymentCreated--><path d="M153.1086,202.6273 C158.6324,203.5381 164.1401,204.3179 169.5,204.9063 C214.1209,209.8044 326.9173,210.1405 371.5,204.9063 C378.4977,204.0847 385.7573,202.8907 392.9468,201.4886 " fill="none" id="PaymentPending-backto-PaymentCreated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="148.0349,201.7559,156.2279,207.2217,152.9627,202.6023,157.5821,199.3371,148.0349,201.7559" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="170.5" y="200.9731">[paymentStatus == "pending"]</text><!--MD5=[5535ea68fd1827fc2aae1cbc899ecbf4]
reverse link PaymentPending to PaymentCreated--><!--MD5=[254f8be3b7cadc4708bc4e5fa0f2d053]
link PaymentPending to PaymentCreated--><path d="M148.027,184.9063 C216.0492,184.9063 319.7016,184.9063 387.5289,184.9063 " fill="none" id="PaymentPending-to-PaymentCreated" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="392.7558,184.9063,383.7558,180.9063,387.7558,184.9063,383.7558,188.9063,392.7558,184.9063" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="166.5" y="177.9731">PaymentWebhookFromZooz</text><!--MD5=[7f679d2b2c3a89838d37318fa5d790f8]
link PaymentPending to CheckPaymentStatus--><path d="M148.2373,205.3604 C165.1171,213.5252 181.4841,224.7164 192.5,239.9063 C204.1814,256.014 207.0716,278.3072 207.0979,296.294 " fill="none" id="PaymentPending-to-CheckPaymentStatus" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="207.0207,301.7261,211.1484,292.784,207.0918,296.7267,203.1492,292.6701,207.0207,301.7261" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="206.5" y="260.4731">Job</text><!--MD5=[7f679d2b2c3a89838d37318fa5d790f8]
link PaymentPending to CheckPaymentStatus--><path d="M59.165,210.2734 C47.0739,228.6336 36.4121,253.3747 49.5,271.9063 C56.758,282.1831 77.3866,291.9021 101.3203,300.2295 " fill="none" id="PaymentPending-to-CheckPaymentStatus-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="106.1481,301.8762,98.9213,295.1849,101.4158,300.262,96.3387,302.7565,106.1481,301.8762" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="50.5" y="260.4731">RequestFromGPM</text><!--MD5=[8ea57b3d1461da481c3748100ace97f8]
reverse link PaymentCreated to CheckPaymentStatus--><path d="M412.5027,207.3623 C393.9504,217.1812 372.0614,228.9402 352.5,239.9063 C316.2322,260.2379 275.5435,284.2451 246.0214,301.8846 " fill="none" id="PaymentCreated-backto-CheckPaymentStatus" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="417.144,204.9094,407.3179,205.5782,412.7234,207.2457,411.056,212.6512,417.144,204.9094" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[62d67b05e0a649bed94ac39a2b2daad1]
link PaymentCreated to PaymentFailed--><path d="M518.2973,184.9063 C582.3383,184.9063 681.0075,184.9063 744.149,184.9063 " fill="none" id="PaymentCreated-to-PaymentFailed" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="749.3884,184.9063,740.3884,180.9063,744.3884,184.9063,740.3884,188.9063,749.3884,184.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="542.25" y="177.9731">[paymentStatus == "failed"]</text><!--MD5=[85f36e8f414ab9084b30a7a44f9e617b]
link PaymentFailed to PaymentWaitForRetry--><path d="M803.1401,205.01 C802.5027,215.4198 801.8152,228.3396 801.5,239.9063 C801.1126,254.1232 801.1126,257.6894 801.5,271.9063 C801.7159,279.8285 802.1064,288.3855 802.5359,296.336 " fill="none" id="PaymentFailed-to-PaymentWaitForRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="802.8377,301.7279,806.3282,292.5184,802.5581,296.7358,798.3407,292.9657,802.8377,301.7279" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="810.5" y="252.9731">[canRetry(paymentError)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="806.5" y="268.106">&amp;&amp; paymentAttempts &lt; 5]</text><!--MD5=[fc2a10dfc4a47560c8312cbf0fc1ce1c]
link PaymentWaitForRetry to PaymentRetry--><path d="M833.065,351.9568 C845.525,365.982 855.304,383.6622 845.5,398.9063 C832.6579,418.8744 811.624,432.4888 789.894,441.7406 " fill="none" id="PaymentWaitForRetry-to-PaymentRetry" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="785.2492,443.6493,795.0941,443.9283,789.874,441.7488,792.0534,436.5287,785.2492,443.6493" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="850.5" y="394.9731">Job</text><!--MD5=[fc2a10dfc4a47560c8312cbf0fc1ce1c]
link PaymentWaitForRetry to PaymentRetry--><path d="M733.6729,352.025 C721.2408,359.6758 709.9243,369.468 702.5,381.9063 C695.1463,394.2261 694.9389,409.6056 697.2785,423.5128 " fill="none" id="PaymentWaitForRetry-to-PaymentRetry-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="698.2472,428.5615,700.4797,418.969,697.3051,423.651,692.623,420.4764,698.2472,428.5615" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="703.5" y="394.9731">RequestFromGPM</text><!--MD5=[df0ed139ce07f55d065f55d83f225821]
reverse link PaymentCreated to PaymentRetry--><path d="M501.7913,207.4428 C539.9276,227.8577 593.4155,260.9704 629.5,301.9063 C663.0113,339.923 686.4183,394.4845 698.914,428.7907 " fill="none" id="PaymentCreated-backto-PaymentRetry" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="497.2188,205.0164,503.2939,212.7684,501.6355,207.36,507.0438,205.7017,497.2188,205.0164" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[25644206834ba35076ff761d3e3a8f6f]
link PaymentFailed to SendingErrorToGPM--><path d="M859.7936,195.3895 C906.6483,205.3573 968.9439,221.5273 986.5,239.9063 C1014.0491,268.7465 1008.5,287.0225 1008.5,326.9063 C1008.5,326.9063 1008.5,326.9063 1008.5,578.9063 C1008.5,618.7901 1004.0496,630.0911 986.5,665.9063 C982.1351,674.8141 976.1661,683.6479 970.0648,691.5442 " fill="none" id="PaymentFailed-to-SendingErrorToGPM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="966.671,695.8293,975.3945,691.2576,969.7754,691.9097,969.1233,686.2906,966.671,695.8293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1017.5" y="457.9731">[paymentAttempts &gt;= 5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="1013.5" y="473.106">|| !canRetry(paymentError)]</text><!--MD5=[c50c04315cb9a8fcf428cedba1f7856a]
link PaymentCreated to PaymentSucceeded--><path d="M445.1419,205.0769 C433.7981,227.976 415.846,266.7274 405.5,301.9063 C392.602,345.7623 385.1738,398.35 381.4846,430.6943 " fill="none" id="PaymentCreated-to-PaymentSucceeded" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="380.9244,435.7071,385.8994,427.2071,381.4798,430.738,377.9489,426.3184,380.9244,435.7071" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="406.5" y="331.4731">[paymentStatus == "succeeded"]</text><!--MD5=[bea7094321f244e861d3c89e3bb3410e]
link PaymentSucceeded to AuthCreated--><path d="M378.5,485.9311 C378.5,505.8038 378.5,533.4777 378.5,553.4598 " fill="none" id="PaymentSucceeded-to-AuthCreated" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="378.5,558.6214,382.5,549.6214,378.5,553.6214,374.5,549.6214,378.5,558.6214" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[6055c901dd4373da366dbd07b21f9783]
reverse link AuthPending to AuthCreated--><path d="M121.1065,561.0236 C125.2752,560.1829 129.4348,559.4604 133.5,558.9063 C172.9133,553.5339 273.1519,553.0754 312.5,558.9063 C318.1849,559.7487 324.0583,560.9784 329.8496,562.4204 " fill="none" id="AuthPending-backto-AuthCreated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="116.2139,562.0618,125.8482,564.1062,121.105,561.0238,124.1874,556.2805,116.2139,562.0618" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="137" y="548.9731">[authStatus == "pending"]</text><!--MD5=[6055c901dd4373da366dbd07b21f9783]
reverse link AuthPending to AuthCreated--><!--MD5=[c2304ffe8deeeade7b8bf031c9e2c54f]
link AuthPending to AuthCreated--><path d="M116.3553,578.9063 C174.7542,578.9063 266.581,578.9063 324.6088,578.9063 " fill="none" id="AuthPending-to-AuthCreated" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="329.7686,578.9063,320.7686,574.9063,324.7686,578.9063,320.7686,582.9063,329.7686,578.9063" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="134.5" y="571.9731">AuthWebhookFromZooz</text><!--MD5=[8764e827cfca4122e5c0eef3faf5564d]
link AuthPending to CheckAuthStatus--><path d="M54.6705,604.1598 C51.1628,622.2361 49.3204,646.6753 58.5,665.9063 C63.2778,675.9157 70.8655,684.6909 79.2705,692.1215 " fill="none" id="AuthPending-to-CheckAuthStatus" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="83.4535,695.6607,79.1664,686.7938,79.6364,692.4311,73.9991,692.9012,83.4535,695.6607" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="59.5" y="654.4731">Job</text><!--MD5=[8764e827cfca4122e5c0eef3faf5564d]
link AuthPending to CheckAuthStatus--><path d="M73.5149,604.0465 C77.9515,613.4017 82.9943,624.1208 87.5,633.9063 C96.2325,652.8717 105.8282,674.2699 113.3162,691.0988 " fill="none" id="AuthPending-to-CheckAuthStatus-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="115.3698,695.7184,115.3688,685.8695,113.3387,691.1495,108.0587,689.1193,115.3698,695.7184" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="103.5" y="654.4731">RequestFromGPM</text><!--MD5=[540548321e49dd8674f3cc7630f55525]
reverse link AuthCreated to CheckAuthStatus--><path d="M346.3165,601.8721 C319.8798,620.2646 281.1206,646.1632 245.5,665.9063 C226.2903,676.5535 204.6538,686.9888 185.1496,695.8592 " fill="none" id="AuthCreated-backto-CheckAuthStatus" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="350.4513,598.9868,340.7816,600.8567,346.3509,601.848,345.3596,607.4173,350.4513,598.9868" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[4cde5cd7f2220b4a9d59f2305741b7d2]
link AuthCreated to AuthFailed--><path d="M427.1257,578.9063 C479.3676,578.9063 561.7876,578.9063 613.1375,578.9063 " fill="none" id="AuthCreated-to-AuthFailed" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="618.3157,578.9063,609.3157,574.9063,613.3157,578.9063,609.3157,582.9063,618.3157,578.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="445.25" y="571.9731">[authStatus == "failed"]</text><!--MD5=[0d2fbab3690e2f4b57d64c268a89f708]
link AuthFailed to AuthWaitForRetry--><path d="M648.4502,599.171 C640.1657,617.1786 631.6507,643.9699 640.5,665.9063 C644.3796,675.5233 650.8348,684.3973 657.93,692.0847 " fill="none" id="AuthFailed-to-AuthWaitForRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="661.456,695.7612,658.1135,686.4968,657.9952,692.1525,652.3395,692.0342,661.456,695.7612" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="649.5" y="646.9731">[canRetry(authError)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="645.5" y="662.106">&amp;&amp; authAttempts &lt; 5]</text><!--MD5=[e30fc7764b6a8ef1a2d6ad0bae4a9b0a]
link AuthWaitForRetry to AuthRetry--><path d="M650.4535,746.1519 C640.424,754.2827 631.0596,764.259 625.5,775.9063 C619.3917,788.703 618.7022,804.0374 620.0526,817.777 " fill="none" id="AuthWaitForRetry-to-AuthRetry" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="620.6362,822.7593,623.5617,813.3549,620.0543,817.7932,615.616,814.2859,620.6362,822.7593" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="626.5" y="788.9731">Job</text><!--MD5=[e30fc7764b6a8ef1a2d6ad0bae4a9b0a]
link AuthWaitForRetry to AuthRetry--><path d="M681.274,746.1107 C671.4547,766.3535 657.5244,795.0713 646.4414,817.9195 " fill="none" id="AuthWaitForRetry-to-AuthRetry-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="644.1221,822.7008,651.6491,816.349,646.3044,818.2021,644.4512,812.8574,644.1221,822.7008" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="665.5" y="788.9731">RequestFromGPM</text><!--MD5=[c3c4073b393a6ac16526e87f947fafee]
reverse link AuthCreated to AuthRetry--><path d="M423.3478,601.4796 C460.6168,622.0215 513.0899,655.2949 548.5,695.9063 C581.8052,734.1037 605.2701,788.6143 617.8342,822.8606 " fill="none" id="AuthCreated-backto-AuthRetry" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="418.8804,599.0379,424.8594,606.8642,423.2678,601.4359,428.6962,599.8443,418.8804,599.0379" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[737e66762b65441531066cd2f554d5d7]
link AuthCreated to AuthSucceeded--><path d="M373.6797,599.1324 C368.209,622.4056 359.18,661.805 352.5,695.9063 C343.2906,742.9201 334.3305,798.1164 329.4003,829.5557 " fill="none" id="AuthCreated-to-AuthSucceeded" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="328.5859,834.7674,333.9277,826.493,329.358,829.8273,326.0237,825.2576,328.5859,834.7674" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="353.5" y="725.4731">[authStatus == "succeeded"]</text><!--MD5=[b4b3b0051f3226614e268067de23f2b0]
link AuthSucceeded to SendingSuccessToGPM--><path d="M325.5,874.9234 C325.5,893.4721 325.5,921.3253 325.5,942.5994 " fill="none" id="AuthSucceeded-to-SendingSuccessToGPM" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="325.5,947.8567,329.5,938.8567,325.5,942.8567,321.5,938.8567,325.5,947.8567" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b2c4af44111247dac179a3c6398f654f]
link SendingSuccessToGPM to Succeeded--><path d="M314.936,998.1848 C312.0147,1019.1601 312.0214,1048.8358 314.956,1069.7713 " fill="none" id="SendingSuccessToGPM-to-Succeeded" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="315.7652,1074.895,318.312,1065.3811,314.9851,1069.9562,310.41,1066.6293,315.7652,1074.895" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[b2c4af44111247dac179a3c6398f654f]
link SendingSuccessToGPM to Succeeded--><!--MD5=[bc38c001bdab1b3998778c9ea5a5e429]
link Succeeded to SendingSuccessToGPM--><path d="M344.5101,1074.6387 C351.2491,1066.1242 358.0195,1055.6971 361.5,1044.9063 C366.2023,1030.3275 360.2783,1015.0337 351.9656,1002.3097 " fill="none" id="Succeeded-to-SendingSuccessToGPM" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="349.0668,998.0979,350.8746,1007.7794,351.9016,1002.2165,357.4645,1003.2436,349.0668,998.0979" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="364.5" y="1040.9731">RequestFromGPM</text><!--MD5=[e0b3af7f089b9cf872053c0061ebebb9]
link AuthFailed to SendingErrorToGPM--><path d="M700.5105,591.0718 C728.93,600.4814 766.9928,615.0781 797.5,633.9063 C815.7171,645.1494 815.7733,653.9047 833.5,665.9063 C848.4489,676.0272 865.5223,685.4622 881.6862,693.5604 " fill="none" id="AuthFailed-to-SendingErrorToGPM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="886.2187,695.8086,879.9334,688.226,881.7394,693.5868,876.3786,695.3929,886.2187,695.8086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="840" y="646.9731">[authAttempts &gt;= 5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="838.5" y="662.106">|| canRetry(authError)]</text><!--MD5=[dd9355a354ffeb2f2b90f073b9c4694f]
link SendingErrorToGPM to Failed--><path d="M933.2784,746.1107 C929.9208,769.9339 929.9073,805.4952 933.2379,829.4128 " fill="none" id="SendingErrorToGPM-to-Failed" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="934.0509,834.6296,936.6172,825.1209,933.2809,829.6892,928.7126,826.3529,934.0509,834.6296" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[dd9355a354ffeb2f2b90f073b9c4694f]
link SendingErrorToGPM to Failed--><!--MD5=[78f39ed7ad5f5916ff4ba290a7542783]
link Failed to SendingErrorToGPM--><path d="M961.7037,834.7172 C973.5359,819.1016 985.7018,796.7054 979.5,775.9063 C976.8311,766.9554 972.1892,758.1064 967.1086,750.2088 " fill="none" id="Failed-to-SendingErrorToGPM" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="964.2506,745.9245,965.9176,755.6312,967.0254,750.0839,972.5727,751.1916,964.2506,745.9245" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="981.5" y="788.9731">RequestFromGPM</text><rect fill="#DDDDDD" height="205.5625" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="222" x="953.5" y="1135.9063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="953.5" x2="1007.5" y1="1149.0547" y2="1149.0547"/><line style="stroke: #000000; stroke-width: 1.0;" x1="953.5" x2="1007.5" y1="1151.0547" y2="1151.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1011.5" y="1153.4014">External Events</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1121.5" x2="1175.5" y1="1149.0547" y2="1149.0547"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1121.5" x2="1175.5" y1="1151.0547" y2="1151.0547"/><ellipse cx="965" cy="1166" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="169" x="972.5" y="1170.1982">AuthWebhookFromZooz</text><ellipse cx="965" cy="1182.2969" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="972.5" y="1186.4951">Job</text><ellipse cx="965" cy="1198.5938" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197" x="972.5" y="1202.792">PaymentWebhookFromZooz</text><ellipse cx="965" cy="1214.8906" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="972.5" y="1219.0889">RequestFromGPM</text><line style="stroke: #000000; stroke-width: 1.0;" x1="953.5" x2="1033" y1="1230.5391" y2="1230.5391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="953.5" x2="1033" y1="1232.5391" y2="1232.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="1037" y="1234.8857">Memory</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1096" x2="1175.5" y1="1230.5391" y2="1230.5391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1096" x2="1175.5" y1="1232.5391" y2="1232.5391"/><ellipse cx="965" cy="1247.4844" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="972.5" y="1251.6826">authAttempts</text><ellipse cx="965" cy="1263.7813" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="972.5" y="1267.9795">authError</text><ellipse cx="965" cy="1280.0781" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="972.5" y="1284.2764">authStatus</text><ellipse cx="965" cy="1296.375" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="972.5" y="1300.5732">paymentAttempts</text><ellipse cx="965" cy="1312.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="972.5" y="1316.8701">paymentError</text><ellipse cx="965" cy="1328.9688" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="972.5" y="1333.167">paymentStatus</text><!--MD5=[60247238c184c2a20f1f2d355b67f43e]
@startuml
hide empty description

title Authorization FSM\n

legend right
  == External Events ==
  * AuthWebhookFromZooz
  * Job
  * PaymentWebhookFromZooz
  * RequestFromGPM
  == Memory ==
  * authAttempts
  * authError
  * authStatus
  * paymentAttempts
  * paymentError
  * paymentStatus
end legend

skinparam StateBackgroundColor<<Permanent>> LightBlue

state Initial             <<Permanent>>
state New                               : createPayment()
state PaymentCreated
state PaymentSucceeded                  : createAuth()
state PaymentPending      <<Permanent>> : scheduleJob()
state PaymentFailed
state PaymentWaitForRetry <<Permanent>> : scheduleJob()
state CheckPaymentStatus                : getPaymentStatusFromZooz()
state PaymentRetry                      : createPayment() \npaymentAttempts++
state AuthCreated
state AuthSucceeded
state AuthPending         <<Permanent>> : scheduleJob()
state AuthFailed
state AuthWaitForRetry    <<Permanent>> : scheduleJob()
state CheckAuthStatus                   : getAuthStatusFromZooz()
state AuthRetry                         : createAuth() \nauthAttempts++
state SendingSuccessToGPM               : sendSuccessToGPM()
state Succeeded           <<Permanent>>
state SendingErrorToGPM                 : sendErrorToGPM()
state Failed              <<Permanent>>


Initial             -right[bold]->   New                 : **RequestFromGPM**
New                 -[dashed]->      PaymentCreated

PaymentCreated      -left->          PaymentPending      : [paymentStatus == "pending"]
PaymentCreated      -left[hidden]->  PaymentPending      : xxxxxxxxxxxxxxxxxxxxxxxxxxxx
PaymentPending      -[bold]->        CheckPaymentStatus  : **Job**
PaymentPending      -[bold]->        CheckPaymentStatus  : **RequestFromGPM**
PaymentPending      -right[bold]->   PaymentCreated      : **PaymentWebhookFromZooz**
CheckPaymentStatus  -up[dashed]->    PaymentCreated

PaymentCreated      -right->         PaymentFailed       : [paymentStatus == "failed"]
PaymentFailed       - ->              PaymentWaitForRetry : [canRetry(paymentError) \n && paymentAttempts < 5]
PaymentWaitForRetry -[bold]->        PaymentRetry        : **Job**
PaymentWaitForRetry -[bold]->        PaymentRetry        : **RequestFromGPM**
PaymentRetry        -up[dashed]->    PaymentCreated

PaymentFailed       - ->              SendingErrorToGPM   : [paymentAttempts >= 5 \n || !canRetry(paymentError)]

PaymentCreated      - - ->             PaymentSucceeded    : [paymentStatus == "succeeded"]
PaymentSucceeded    -[dashed]->      AuthCreated

AuthCreated         -left->          AuthPending         : [authStatus == "pending"]
AuthCreated         -left[hidden]->  AuthPending         : xxxxxxxxxxxxxxxxxxxxxxxxx
AuthPending         -[bold]->        CheckAuthStatus     : **Job**
AuthPending         -[bold]->        CheckAuthStatus     : **RequestFromGPM**
AuthPending         -right[bold]->   AuthCreated         : **AuthWebhookFromZooz**
CheckAuthStatus     -up[dashed]->    AuthCreated

AuthCreated         -right->         AuthFailed          : [authStatus == "failed"]
AuthFailed          - ->              AuthWaitForRetry    : [canRetry(authError) \n && authAttempts < 5]
AuthWaitForRetry    -[bold]->        AuthRetry           : **Job**
AuthWaitForRetry    -[bold]->        AuthRetry           : **RequestFromGPM**
AuthRetry           -up[dashed]->    AuthCreated

AuthCreated         - - ->             AuthSucceeded       : [authStatus == "succeeded"]
AuthSucceeded       -[dashed]->      SendingSuccessToGPM
SendingSuccessToGPM -[dashed]->      Succeeded
SendingSuccessToGPM -[hidden]->      Succeeded
Succeeded           -[bold]->        SendingSuccessToGPM : **RequestFromGPM**

AuthFailed          - ->              SendingErrorToGPM   : [authAttempts >= 5 \n || canRetry(authError)]
SendingErrorToGPM   -[dashed]->      Failed
SendingErrorToGPM   -[hidden]->      Failed
Failed              -[bold]->        SendingErrorToGPM   : **RequestFromGPM**


@enduml

PlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>