<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1646px" preserveAspectRatio="none" style="width:1721px;height:1646px;" version="1.1" viewBox="0 0 1721 1646" width="1721px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ahnz609m6e38" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="161" x="773.5" y="16.708">Authorization FSM</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="857" y="37.6611"/><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="187" y="48.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="195" y="73.7529">Initial</text><g id="New"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="318" x="53" y="165.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="53" x2="371" y1="192.2031" y2="192.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="197" y="183.9014">New</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="298" x="58" y="208.3418">paymentStatus, paymentErr = createPayment()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="131" x="58" y="222.3105">paymentAttempts++</text></g><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="701.5" y="177.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="706.5" y="202.7529">PaymentCreated</text><g id="PaymentSucceeded"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="218" x="382" y="463.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="382" x2="600" y1="490.2031" y2="490.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="421.5" y="481.9014">PaymentSucceeded</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="198" x="387" y="506.3418">tokenErr = getTokenFromPMS()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="113" x="387" y="520.3105">tokenAttempts++</text></g><g id="TokenOK"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="378" x="512" y="751.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="512" x2="890" y1="778.2031" y2="778.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="669" y="769.9014">TokenOK</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="358" x="517" y="794.3418">authStatus, authFailureMessage, authErr = createAuth()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="106" x="517" y="808.3105">authAttempts++</text></g><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1139.5" y="896.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="1144.5" y="921.2529">AuthCreated</text><g id="AuthSucceeded"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="994.5" y="1023.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="994.5" x2="1149.5" y1="1050.2031" y2="1050.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1016.5" y="1041.9014">AuthSucceeded</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="135" x="999.5" y="1066.3418">sendSuccessToGPM()</text></g><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1018.5" y="1192.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1023.5" y="1217.7529">Succeeded</text><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="392.5" y="1028.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="397.5" y="1053.7529">AuthError</text><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="855" y="1028.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="860" y="1053.7529">AuthFailed</text><g id="AuthPending"><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="1349" y="1016.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1349" x2="1503" y1="1043.2031" y2="1043.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="1381.5" y="1034.9014">AuthPending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="134" x="1354" y="1059.3418">sendPendingToGPM()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="1354" y="1073.3105">scheduleJob()</text></g><g id="AuthRetry"><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="640" y="1187.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="640" x2="746" y1="1214.2031" y2="1214.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="659" y="1205.9014">AuthRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="645" y="1230.3418">scheduleJob()</text></g><g id="CheckAuthStatus"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="325" x="1198.5" y="1187.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1198.5" x2="1523.5" y1="1214.2031" y2="1214.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1301" y="1205.9014">CheckAuthStatus</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="305" x="1203.5" y="1230.3418">authStatus, authErr = getAuthStatusFromZooz()</text></g><g id="CheckPaymentStatus"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="320" x="662" y="470.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="662" x2="982" y1="497.2031" y2="497.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="748" y="488.9014">CheckPaymentStatus</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="300" x="667" y="513.3418">paymentStatus = getPaymentStatusFromZooz()</text></g><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="50" x="204" y="1314.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="209" y="1339.7529">Failed</text><g id="Failing"><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="162" y="1187.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="162" x2="296" y1="1214.2031" y2="1214.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="207.5" y="1205.9014">Failing</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="114" x="167" y="1230.3418">sendErrorToGPM()</text></g><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="107.5" y="311.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="112.5" y="336.7529">PaymentError</text><g id="PaymentPending"><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="137" x="873.5" y="306.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="873.5" x2="1010.5" y1="333.2031" y2="333.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="883.5" y="324.9014">PaymentPending</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="878.5" y="349.3418">scheduleJob()</text></g><g id="PaymentRetry"><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="64" y="470.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="64" x2="180" y1="497.2031" y2="497.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="74" y="488.9014">PaymentRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="69" y="513.3418">scheduleJob()</text></g><rect fill="#FEFECE" filter="url(#f1ahnz609m6e38)" height="40" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="214.5" y="604.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="219.5" y="629.7529">TokenError</text><g id="TokenRetry"><rect fill="#ADD8E6" filter="url(#f1ahnz609m6e38)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="106" x="348" y="758.9063"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="348" x2="454" y1="785.2031" y2="785.2031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="361" y="776.9014">TokenRetry</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="353" y="801.3418">scheduleJob()</text></g><!--MD5=[2580f5798eb5af3b4cc67017305f336d]
link Initial to New--><path d="M212,89.0624 C212,108.1675 212,137.3329 212,160.6657 " fill="none" id="Initial-to-New" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="212,165.8529,216,156.8529,212,160.8529,208,156.8529,212,165.8529" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="213" y="131.9731">RequestFromGPM</text><!--MD5=[ac09641cf070fd0512798f45784a3aec]
link New to PaymentCreated--><path d="M371.2909,197.9063 C478.9535,197.9063 615.6586,197.9063 696.1108,197.9063 " fill="none" id="New-to-PaymentCreated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="701.3278,197.9063,692.3278,193.9063,696.3278,197.9063,692.3278,201.9063,701.3278,197.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="471.75" y="190.9731">[paymentErr == nil]</text><!--MD5=[c50c04315cb9a8fcf428cedba1f7856a]
link PaymentCreated to PaymentSucceeded--><path d="M701.4119,213.931 C652.1029,229.6961 585.1859,258.5751 545,306.9063 C508.6988,350.5653 496.774,417.3101 492.8736,458.6897 " fill="none" id="PaymentCreated-to-PaymentSucceeded" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="492.4159,463.8561,497.1946,455.2442,492.8572,458.8756,489.2258,454.5381,492.4159,463.8561" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="546" y="336.4731">[paymentStatus == "succeeded"]</text><!--MD5=[bd9a34583b9ce91f841e78490a0cdd27]
link PaymentSucceeded to TokenOK--><path d="M534.2163,528.088 C559.1534,548.1958 589.8571,575.7465 612,604.9063 C645.8464,649.4782 672.3669,708.9239 687.3607,746.8185 " fill="none" id="PaymentSucceeded-to-TokenOK" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="689.3102,751.7891,689.7478,741.9499,687.4845,747.1343,682.3002,744.871,689.3102,751.7891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="638" y="629.4731">[tokenErr == nil]</text><!--MD5=[cad27899b2a12c2324b53c03114e353e]
link TokenOK to AuthCreated--><path d="M818.8891,815.9809 C919.2921,843.2978 1058.9313,881.2901 1134.4179,901.828 " fill="none" id="TokenOK-to-AuthCreated" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1139.2962,903.1553,1131.6621,896.9327,1134.4716,901.8426,1129.5618,904.6521,1139.2962,903.1553" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="989" y="858.9731">[authErr == nil]</text><!--MD5=[737e66762b65441531066cd2f554d5d7]
link AuthCreated to AuthSucceeded--><path d="M1139.4139,928.0158 C1116.9732,935.9761 1092.2056,949.0059 1078,969.9063 C1068.483,983.9083 1066.7306,1002.7086 1067.4764,1018.4561 " fill="none" id="AuthCreated-to-AuthSucceeded" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1067.8174,1023.6682,1071.221,1014.4261,1067.4908,1018.6788,1063.2381,1014.9486,1067.8174,1023.6682" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="1079" y="982.9731">[authStatus == "succeeded"]</text><!--MD5=[70e222a402221e2a10d56c560f44ae26]
link AuthSucceeded to Succeeded--><path d="M1061.101,1074.1719 C1055.1083,1104.9189 1052.2641,1156.5398 1054.8534,1187.3967 " fill="none" id="AuthSucceeded-to-Succeeded" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1055.3578,1192.5356,1058.4592,1183.1878,1054.8692,1187.5595,1050.4975,1183.9695,1055.3578,1192.5356" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e2270853807ec3ca3690d28aedbb2236]
link Succeeded to AuthSucceeded--><path d="M1080.3199,1192.6772 C1087.6043,1182.8593 1095.2499,1170.4831 1099,1157.9063 C1104.9689,1137.8883 1103.2596,1131.3563 1099,1110.9063 C1096.7369,1100.0413 1092.4635,1088.7463 1087.9732,1078.8205 " fill="none" id="Succeeded-to-AuthSucceeded" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1085.7592,1074.0657,1085.9321,1083.913,1087.8698,1078.5984,1093.1844,1080.5361,1085.7592,1074.0657" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="1103" y="1138.9731">RequestFromGPM</text><!--MD5=[e2270853807ec3ca3690d28aedbb2236]
link Succeeded to AuthSucceeded--><!--MD5=[4cde5cd7f2220b4a9d59f2305741b7d2]
link AuthCreated to AuthFailed--><path d="M1139.3886,918.8191 C1067.0161,923.488 936.1001,936.4352 905,969.9063 C891.8865,984.0196 890.3962,1006.2239 891.7534,1023.5029 " fill="none" id="AuthCreated-to-AuthFailed" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="892.2563,1028.6928,895.3695,1019.3489,891.774,1023.7161,887.4068,1020.1205,892.2563,1028.6928" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="906" y="982.9731">[authStatus == "failed"]</text><!--MD5=[00645dbcaf87367c515499790cb63305]
link AuthCreated to AuthPending--><path d="M1236.7293,920.4551 C1327.4629,928.4897 1514.8874,947.6112 1534,969.9063 C1550.5796,989.2465 1533.1399,1006.513 1507.7828,1019.9337 " fill="none" id="AuthCreated-to-AuthPending" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1503.3076,1022.2241,1513.1417,1021.6847,1507.7586,1019.9462,1509.4971,1014.5631,1503.3076,1022.2241" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="1541" y="982.9731">[authStatus == "pending"]</text><!--MD5=[c2304ffe8deeeade7b8bf031c9e2c54f]
link AuthPending to AuthCreated--><path d="M1385.52,1016.8299 C1365.0817,1001.4959 1339.481,983.5557 1315,969.9063 C1291.6868,956.908 1264.5734,945.0783 1241.3998,935.8672 " fill="none" id="AuthPending-to-AuthCreated" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1236.5173,933.9418,1243.4226,940.9645,1241.1687,935.776,1246.3572,933.5222,1236.5173,933.9418" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="1341" y="982.9731">AuthWebhookFromZooz</text><!--MD5=[68f6d5db1322b623c5fc05cf1b162db0]
link AuthError to AuthRetry--><path d="M422.3314,1069.0963 C414.6689,1093.0734 406.6777,1132.9522 427,1157.9063 C452.6487,1189.4008 564.2224,1203.4137 634.4699,1209.2112 " fill="none" id="AuthError-to-AuthRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="639.8738,1209.6476,631.2252,1204.9358,634.89,1209.2449,630.5809,1212.9098,639.8738,1209.6476" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="428" y="1123.9731">[canTechnicalRetry(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="440" y="1139.106">authErr,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="440" y="1154.2388">authAttempts)]</text><!--MD5=[d7a165085d8e009b1471c536a4be0b1a]
link AuthError to Failing--><path d="M392.2501,1052.0477 C352.4374,1057.4029 290.6415,1071.8682 255,1110.9063 C237.319,1130.2723 231.2904,1159.9758 229.4064,1182.343 " fill="none" id="AuthError-to-Failing" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="229.0294,1187.5719,233.6665,1178.8829,229.3891,1182.5848,225.6872,1178.3074,229.0294,1187.5719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="256" y="1123.9731">[!canTechnicalRetry(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="268" y="1139.106">authErr,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="268" y="1154.2388">authAttempts)]</text><!--MD5=[84c4ed5fd3554db77c2cd7c0c9d96cf2]
link AuthFailed to AuthRetry--><path d="M889.1461,1068.914 C879.9233,1093.0841 861.3313,1133.5286 833,1157.9063 C809.7063,1177.9493 778.2459,1191.1873 751.0486,1199.6413 " fill="none" id="AuthFailed-to-AuthRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="746.0228,1201.1648,755.7962,1202.3817,750.8078,1199.7142,753.4753,1194.7258,746.0228,1201.1648" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="869" y="1123.9731">[canRetryAuth(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="881" y="1139.106">authFailureMessage,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="881" y="1154.2388">authAttempts)]</text><!--MD5=[0aed6d362090704fd8850b9cc073f397]
link AuthFailed to Failing--><path d="M854.8129,1059.3114 C810.8704,1070.7283 739.4164,1090.2028 679,1110.9063 C625.9875,1129.0727 615.966,1142.806 562,1157.9063 C474.007,1182.5277 369.6561,1197.561 301.5244,1205.5515 " fill="none" id="AuthFailed-to-Failing" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="296.2741,1206.1617,305.6758,1209.0955,301.2406,1205.5842,304.7519,1201.149,296.2741,1206.1617" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="680" y="1123.9731">[!canRetryAuth(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="692" y="1139.106">authFailureMessage,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="692" y="1154.2388">authAttempts)]</text><!--MD5=[8764e827cfca4122e5c0eef3faf5564d]
link AuthPending to CheckAuthStatus--><path d="M1380.0422,1080.9474 C1371.0999,1089.5598 1362.9684,1099.6528 1358,1110.9063 C1347.9975,1133.5622 1349.8136,1161.8901 1353.5235,1182.9396 " fill="none" id="AuthPending-to-CheckAuthStatus" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1354.4471,1187.8552,1356.7161,1178.2712,1353.5237,1182.9412,1348.8537,1179.7487,1354.4471,1187.8552" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="1359" y="1138.9731">Job</text><!--MD5=[8764e827cfca4122e5c0eef3faf5564d]
link AuthPending to CheckAuthStatus--><path d="M1415.3822,1081.1766 C1407.9632,1103.0383 1397.5346,1132.4663 1387,1157.9063 C1383.6202,1166.0681 1379.6735,1174.7677 1375.8911,1182.7825 " fill="none" id="AuthPending-to-CheckAuthStatus-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1373.5638,1187.6734,1381.0428,1181.2652,1375.7122,1183.1584,1373.819,1177.8278,1373.5638,1187.6734" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="1405" y="1138.9731">RequestFromGPM</text><!--MD5=[fa910f1c142671ef9f65502d8fb2b3eb]
link AuthRetry to TokenOK--><path d="M746.0452,1193.2527 C761.3595,1184.8214 776.2776,1173.283 785,1157.9063 C848.3746,1046.1833 768.4366,890.3293 725.2632,820.3983 " fill="none" id="AuthRetry-to-TokenOK" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="722.4745,815.9177,723.8341,825.6722,725.1165,820.1626,730.6261,821.445,722.4745,815.9177" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="799" y="982.9731">Job</text><!--MD5=[fa910f1c142671ef9f65502d8fb2b3eb]
link AuthRetry to TokenOK--><path d="M639.5613,1192.5945 C624.7503,1184.2065 610.4345,1172.8594 602,1157.9063 C591.7374,1139.7122 598.9406,1131.5699 602,1110.9063 C618.0125,1002.7558 662.2879,880.8268 685.8272,821.0245 " fill="none" id="AuthRetry-to-TokenOK-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="687.7622,816.1299,680.7335,823.0289,685.9239,820.7797,688.1732,825.9701,687.7622,816.1299" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="635" y="982.9731">RequestFromGPM</text><!--MD5=[19cb819314e2cdcc17aa6896a4a39512]
link CheckAuthStatus to AuthCreated--><path d="M1352.2906,1187.9014 C1330.9642,1126.7642 1277.597,974.363 1274,969.9063 C1264.078,957.6128 1250.5279,947.3585 1237.1184,939.2266 " fill="none" id="CheckAuthStatus-to-AuthCreated" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1232.5816,936.5503,1238.3007,944.5684,1236.888,939.0908,1242.3657,937.6781,1232.5816,936.5503" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8e2fa321b0aeb8233ab027e8edc47221]
link CheckPaymentStatus to PaymentCreated--><path d="M809.7024,470.798 C804.7452,459.7233 799.4049,446.4068 796,433.9063 C775.5865,358.9605 767.9008,266.92 765.2557,223.2343 " fill="none" id="CheckPaymentStatus-to-PaymentCreated" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="764.9576,218.1509,761.4913,227.3696,765.2503,223.1423,769.4776,226.9012,764.9576,218.1509" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[58d72c151b814742bda34026fd93bbd4]
link Failed to Failing--><path d="M248.0101,1314.6387 C254.7491,1306.1242 261.5195,1295.6971 265,1284.9063 C269.7023,1270.3275 263.7783,1255.0337 255.4656,1242.3097 " fill="none" id="Failed-to-Failing" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="252.5668,1238.0979,254.3746,1247.7794,255.4016,1242.2165,260.9645,1243.2436,252.5668,1238.0979" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="268" y="1280.9731">RequestFromGPM</text><!--MD5=[58d72c151b814742bda34026fd93bbd4]
link Failed to Failing--><!--MD5=[7cef379aa709ef9b1d5f282bb0c43023]
link Failing to Failed--><path d="M218.436,1238.1848 C215.5147,1259.1601 215.5214,1288.8358 218.456,1309.7713 " fill="none" id="Failing-to-Failed" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="219.2652,1314.895,221.812,1305.3811,218.4851,1309.9562,213.91,1306.6293,219.2652,1314.895" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[9abe1cc9c59848884b7d1a4a74657168]
link New to PaymentError--><path d="M158.8969,229.9894 C149.231,238.4371 140.4837,248.4506 135,259.9063 C127.7421,275.0685 133.6787,293.0001 141.4613,307.1751 " fill="none" id="New-to-PaymentError" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="144.155,311.8289,143.1081,302.0358,141.6501,307.5015,136.1844,306.0436,144.155,311.8289" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="136" y="272.9731">[paymentErr != nil]</text><!--MD5=[ec29f6f137cf13762f3b9b85bf5877a0]
link PaymentCreated to PaymentPending--><path d="M773.9812,218.0621 C783.5063,235.5666 799.3053,260.6 819,276.9063 C833.5753,288.974 851.221,298.9069 868.5413,306.8492 " fill="none" id="PaymentCreated-to-PaymentPending" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="873.4151,309.0367,866.8422,301.702,868.8535,306.9892,863.5663,309.0005,873.4151,309.0367" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="820" y="272.9731">[paymentStatus == "pending"]</text><!--MD5=[254f8be3b7cadc4708bc4e5fa0f2d053]
link PaymentPending to PaymentCreated--><path d="M1001.0758,306.7643 C1022.6908,293.961 1038.8384,277.4171 1025,259.9063 C1001.3591,229.9916 901.1913,212.9806 832.0586,204.6045 " fill="none" id="PaymentPending-to-PaymentCreated" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="826.7206,203.9672,835.183,209.0059,831.6853,204.56,836.1313,201.0623,826.7206,203.9672" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="1031" y="272.9731">PaymentWebhookFromZooz</text><!--MD5=[480fac652fb78b5471565f796abd4ff5]
link PaymentError to Failing--><path d="M119.5987,352.1183 C74.2659,378.5155 6,429.3208 6,495.9063 C6,495.9063 6,495.9063 6,1048.9063 C6,1125.1343 91.6107,1169.8608 156.7433,1192.8583 " fill="none" id="PaymentError-to-Failing" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="161.7902,1194.6116,154.6013,1187.8796,157.0671,1192.9707,151.976,1195.4365,161.7902,1194.6116" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="7" y="773.4731">[!canRetryPayment(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="19" y="788.606">paymentError,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="19" y="803.7388">paymentAttempts)]</text><!--MD5=[f10a5a0a23210d8d7de3325ebca8f05e]
link PaymentError to PaymentRetry--><path d="M139.5738,352.0852 C131.5497,361.7995 123.1624,374.1063 119,386.9063 C110.7078,412.4063 112.5102,443.0572 115.775,465.3525 " fill="none" id="PaymentError-to-PaymentRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="116.584,470.5467,119.1514,461.0383,115.8146,465.6062,111.2467,462.2694,116.584,470.5467" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="120" y="399.9731">[canRetryPayment(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="132" y="415.106">paymentError,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="132" y="430.2388">paymentAttempts)]</text><!--MD5=[7f679d2b2c3a89838d37318fa5d790f8]
link PaymentPending to CheckPaymentStatus--><path d="M954.8904,356.9528 C964.2223,378.9113 972.8348,410.8398 958,433.9063 C948.6505,448.4438 934.9591,459.6136 919.8183,468.184 " fill="none" id="PaymentPending-to-CheckPaymentStatus" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="915.076,470.7612,924.8937,469.978,919.4691,468.3736,921.0736,462.949,915.076,470.7612" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="967" y="414.9731">Job</text><!--MD5=[7f679d2b2c3a89838d37318fa5d790f8]
link PaymentPending to CheckPaymentStatus--><path d="M873.356,345.6695 C850.8987,353.7814 828.3207,366.6213 815,386.9063 C799.7436,410.1391 804.2522,442.5001 810.894,465.9204 " fill="none" id="PaymentPending-to-CheckPaymentStatus-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="812.3374,470.7758,813.6072,461.0091,810.9127,465.983,805.9388,463.2886,812.3374,470.7758" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="816" y="414.9731">RequestFromGPM</text><!--MD5=[50efea94a8925a072ce12a78406a479e]
link PaymentRetry to New--><path d="M103.0434,470.8271 C77.4962,433.7356 38.1446,362.6344 65,306.9063 C80.2524,275.2557 109.7575,250.6101 138.3557,232.8237 " fill="none" id="PaymentRetry-to-New" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="142.9354,230.0278,133.1695,231.3032,138.6678,232.6331,137.3378,238.1314,142.9354,230.0278" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="66" y="336.4731">Job</text><!--MD5=[50efea94a8925a072ce12a78406a479e]
link PaymentRetry to New--><path d="M180.3036,486.1192 C210.7482,477.7282 245.4375,462.2657 264,433.9063 C306.3522,369.2012 290.4412,332.5789 264,259.9063 C260.7172,250.8836 255.4811,242.2596 249.5685,234.4644 " fill="none" id="PaymentRetry-to-New-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="246.2223,230.2218,248.6552,239.7655,249.3187,234.1477,254.9365,234.8112,246.2223,230.2218" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="292" y="336.4731">RequestFromGPM</text><!--MD5=[6cfb58829e2a290f2afde2c5adad708c]
link PaymentSucceeded to TokenError--><path d="M381.9563,515.5129 C334.8342,526.1595 286.8536,540.6782 271,557.9063 C260.71,569.0884 257.4674,585.8821 256.7936,599.8583 " fill="none" id="PaymentSucceeded-to-TokenError" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="256.6532,604.8644,260.9039,595.98,256.7933,599.8663,252.907,595.7558,256.6532,604.8644" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="272" y="570.9731">[tokenErr != nil]</text><!--MD5=[4c13d4ea437d8792da2d9dbd749e2e2d]
link TokenError to Failing--><path d="M245.4149,645.1319 C228.3566,674.5302 200,731.31 200,783.9063 C200,783.9063 200,783.9063 200,1048.9063 C200,1096.2501 211.8639,1150.1233 220.4152,1182.805 " fill="none" id="TokenError-to-Failing" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="221.7569,1187.864,223.3161,1178.1393,220.4752,1183.031,215.5834,1180.1901,221.7569,1187.864" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="201" y="905.9731">[!canRetryToken(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="213" y="921.106">tokenErr,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="213" y="936.2388">tokenAttempts)]</text><!--MD5=[15edabc372b8910966acf0da3460b88f]
link TokenError to TokenRetry--><path d="M251.0994,644.9421 C245.2045,665.9417 239.844,699.0043 255,721.9063 C274.4747,751.3344 311.0352,766.8362 342.6967,774.98 " fill="none" id="TokenError-to-TokenRetry" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="347.7328,776.2249,339.9556,770.182,342.8789,775.025,338.0359,777.9483,347.7328,776.2249" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="256" y="687.9731">[canRetryToken(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="268" y="703.106">tokenErr,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="268" y="718.2388">tokenAttempts)]</text><!--MD5=[f7da95c3d67104f2049b064c9d1a5b31]
link TokenOK to AuthError--><path d="M567.5153,815.962 C526.0909,832.3505 484.2134,856.7715 457,892.9063 C428.0417,931.358 426.0684,990.2076 427.7115,1023.5512 " fill="none" id="TokenOK-to-AuthError" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="428.0027,1028.6766,431.4856,1019.4641,427.719,1023.6846,423.4985,1019.918,428.0027,1028.6766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="458" y="920.9731">[authErr != nil]</text><!--MD5=[97a5ea8d068f2c55c2891e05e2f49dd2]
link TokenRetry to PaymentSucceeded--><path d="M401.8422,758.8846 C403.6782,723.6188 409.5082,657.7034 428,604.9063 C436.9711,579.2924 452.0607,552.8828 465.2231,532.4751 " fill="none" id="TokenRetry-to-PaymentSucceeded" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="467.9996,528.2139,459.7349,533.5706,465.27,532.403,466.4376,537.9381,467.9996,528.2139" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="429" y="629.4731">Job</text><!--MD5=[97a5ea8d068f2c55c2891e05e2f49dd2]
link TokenRetry to PaymentSucceeded--><path d="M415.8189,758.8168 C421.971,747.7455 428.858,734.4265 434,721.9063 C460.2,658.112 476.7784,579.0917 484.9339,533.3937 " fill="none" id="TokenRetry-to-PaymentSucceeded-1" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="485.8394,528.2614,480.3366,536.4295,484.9707,533.1853,488.2149,537.8194,485.8394,528.2614" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="470" y="629.4731">RequestFromGPM</text><rect fill="#DDDDDD" height="254.4531" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="222" x="1477" y="1375.9063"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1477" x2="1531" y1="1389.0547" y2="1389.0547"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1477" x2="1531" y1="1391.0547" y2="1391.0547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1535" y="1393.4014">External Events</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1645" x2="1699" y1="1389.0547" y2="1389.0547"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1645" x2="1699" y1="1391.0547" y2="1391.0547"/><ellipse cx="1488.5" cy="1406" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="169" x="1496" y="1410.1982">AuthWebhookFromZooz</text><ellipse cx="1488.5" cy="1422.2969" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="1496" y="1426.4951">Job</text><ellipse cx="1488.5" cy="1438.5938" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197" x="1496" y="1442.792">PaymentWebhookFromZooz</text><ellipse cx="1488.5" cy="1454.8906" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="1496" y="1459.0889">RequestFromGPM</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1477" x2="1556.5" y1="1470.5391" y2="1470.5391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1477" x2="1556.5" y1="1472.5391" y2="1472.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="1560.5" y="1474.8857">Memory</text><line style="stroke: #000000; stroke-width: 1.0;" x1="1619.5" x2="1699" y1="1470.5391" y2="1470.5391"/><line style="stroke: #000000; stroke-width: 1.0;" x1="1619.5" x2="1699" y1="1472.5391" y2="1472.5391"/><ellipse cx="1488.5" cy="1487.4844" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="94" x="1496" y="1491.6826">authAttempts</text><ellipse cx="1488.5" cy="1503.7813" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1496" y="1507.9795">authErr</text><ellipse cx="1488.5" cy="1520.0781" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="1496" y="1524.2764">authFailureMessage</text><ellipse cx="1488.5" cy="1536.375" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1496" y="1540.5732">authStatus</text><ellipse cx="1488.5" cy="1552.6719" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="1496" y="1556.8701">paymentAttempts</text><ellipse cx="1488.5" cy="1568.9688" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1496" y="1573.167">paymentErr</text><ellipse cx="1488.5" cy="1585.2656" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1496" y="1589.4639">paymentStatus</text><ellipse cx="1488.5" cy="1601.5625" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1496" y="1605.7607">tokenAttempts</text><ellipse cx="1488.5" cy="1617.8594" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1496" y="1622.0576">tokenErr</text><!--MD5=[0bb446a99cdd370018a059ee6c47a539]
@startuml
hide empty description

title Authorization FSM\n

legend right
  == External Events ==
  * AuthWebhookFromZooz
  * Job
  * PaymentWebhookFromZooz
  * RequestFromGPM
  == Memory ==
  * authAttempts
  * authErr
  * authFailureMessage
  * authStatus
  * paymentAttempts
  * paymentErr
  * paymentStatus
  * tokenAttempts
  * tokenErr
end legend

skinparam StateBackgroundColor<<Permanent>> LightBlue

state Initial            <<Permanent>>
state New                              : paymentStatus, paymentErr = createPayment()\npaymentAttempts++
state PaymentCreated
state PaymentSucceeded                 : tokenErr = getTokenFromPMS()\ntokenAttempts++
state TokenOK                          : authStatus, authFailureMessage, authErr = createAuth()\nauthAttempts++
state AuthCreated
state AuthSucceeded                    : sendSuccessToGPM()
state Succeeded          <<Permanent>>
state AuthError
state AuthFailed
state AuthPending        <<Permanent>> : sendPendingToGPM()\nscheduleJob()
state AuthRetry          <<Permanent>> : scheduleJob()
state CheckAuthStatus                  : authStatus, authErr = getAuthStatusFromZooz()
state CheckPaymentStatus               : paymentStatus = getPaymentStatusFromZooz()
state Failed             <<Permanent>>
state Failing                          : sendErrorToGPM()
state PaymentError
state PaymentPending     <<Permanent>> : scheduleJob()
state PaymentRetry       <<Permanent>> : scheduleJob()
state TokenError
state TokenRetry         <<Permanent>> : scheduleJob()


Initial             -[bold]->    New                : **RequestFromGPM**
New                 ->           PaymentCreated     : [paymentErr == nil]
PaymentCreated      - - ->         PaymentSucceeded   : [paymentStatus == "succeeded"]
PaymentSucceeded    - - ->         TokenOK            : [tokenErr == nil]
TokenOK             - ->          AuthCreated        : [authErr == nil]
AuthCreated         - ->          AuthSucceeded      : [authStatus == "succeeded"]
AuthSucceeded       -[dashed]->  Succeeded
Succeeded           -[bold]->    AuthSucceeded      : **RequestFromGPM**
Succeeded           -[hidden]->  AuthSucceeded

AuthCreated         - ->          AuthFailed         : [authStatus == "failed"]
AuthCreated         - ->          AuthPending        : [authStatus == "pending"]
AuthError           - ->          AuthRetry          : [canTechnicalRetry(\l   authErr,\l   authAttempts)]
AuthError           - ->          Failing            : [!canTechnicalRetry(\l   authErr,\l   authAttempts)]
AuthFailed          - ->          AuthRetry          : [canRetryAuth(\l   authFailureMessage,\l   authAttempts)]
AuthFailed          - ->          Failing            : [!canRetryAuth(\l   authFailureMessage,\l   authAttempts)]
AuthPending         -[bold]->    AuthCreated        : **AuthWebhookFromZooz**
AuthPending         -[bold]->    CheckAuthStatus    : **Job**
AuthPending         -[bold]->    CheckAuthStatus    : **RequestFromGPM**
AuthRetry           -[bold]->    TokenOK            : **Job**
AuthRetry           -[bold]->    TokenOK            : **RequestFromGPM**
CheckAuthStatus     -[dashed]->  AuthCreated
CheckPaymentStatus  -[dashed]->  PaymentCreated
Failed              -[bold]->    Failing            : **RequestFromGPM**
Failed              -[hidden]->  Failing
Failing             -[dashed]->  Failed
New                 - ->          PaymentError       : [paymentErr != nil]
PaymentCreated      - ->          PaymentPending     : [paymentStatus == "pending"]
PaymentError        - ->          Failing            : [!canRetryPayment(\l   paymentError,\l   paymentAttempts)]
PaymentError        - ->          PaymentRetry       : [canRetryPayment(\l   paymentError,\l   paymentAttempts)]
PaymentPending      -[bold]->    CheckPaymentStatus : **Job**
PaymentPending      -[bold]->    CheckPaymentStatus : **RequestFromGPM**
PaymentPending      -[bold]->    PaymentCreated     : **PaymentWebhookFromZooz**
PaymentRetry        -[bold]->    New                : **Job**
PaymentRetry        -[bold]->    New                : **RequestFromGPM**
PaymentSucceeded    - ->          TokenError         : [tokenErr != nil]
TokenError          - ->          Failing            : [!canRetryToken(\l   tokenErr,\l   tokenAttempts)]
TokenError          - ->          TokenRetry         : [canRetryToken(\l   tokenErr,\l   tokenAttempts)]
TokenOK             - ->          AuthError          : [authErr != nil]
TokenRetry          -[bold]->    PaymentSucceeded   : **Job**
TokenRetry          -[bold]->    PaymentSucceeded   : **RequestFromGPM**

@enduml

PlantUML version 1.2020.19(Mon Oct 12 15:10:01 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>